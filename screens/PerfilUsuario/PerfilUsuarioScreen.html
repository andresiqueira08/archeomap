<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Perfil - Mapa Colaborativo</title>
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="../../css/mobile.css">
</head>
<body>
    <div class="screen perfil-screen active">
        <div class="page">
            <div class="top-bar">
                <div class="top"></div>
                <div class="content">
                    <div class="title">Meu Perfil</div>
                    <div class="icon-buttons">
                        <div class="icon" id="btnBack">‚Üê</div>
                    </div>
                </div>
            </div>
            
            <div class="perfil-container">
                <div class="perfil-header">
                    <div class="avatar-container">
                        <div class="avatar" id="userAvatar">
                            </div>
                        <div class="avatar-edit" id="btnEditAvatar">‚úé</div>
                    </div>
                    
                    <div class="perfil-info">
                        <h2 class="user-name" id="userName">Carregando...</h2>
                        <p class="user-email" id="userEmail">carregando@email.com</p>
                        <div class="user-badge" id="userBadge">
                            <span id="userType">Carregando...</span>
                        </div>
                    </div>
                </div>
                
                <div class="perfil-stats" id="perfilStats">
                    <div class="stat-card">
                        <div class="stat-number" id="statMaps">0</div>
                        <div class="stat-label">Mapas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statFindings">0</div>
                        <div class="stat-label">Achados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statPoints">0</div>
                        <div class="stat-label">Pontos</div>
                    </div>
                </div>
                
                <div class="perfil-actions">
                    <div class="action-group">
                        <h3 class="action-title">Conta</h3>
                        
                        <div class="action-item" id="btnEditProfile">
                            <div class="action-icon">üë§</div>
                            <div class="action-content">
                                <div class="action-text">Editar Perfil</div>
                                <div class="action-subtext">Alterar informa√ß√µes pessoais</div>
                            </div>
                            <div class="action-arrow">‚Ä∫</div>
                        </div>
                        
                        <div class="action-item" id="btnSettings">
                            <div class="action-icon">‚öôÔ∏è</div>
                            <div class="action-content">
                                <div class="action-text">Configura√ß√µes</div>
                                <div class="action-subtext">Prefer√™ncias do app</div>
                            </div>
                            <div class="action-arrow">‚Ä∫</div>
                        </div>
                    </div>
                    
                    <div class="action-group">
                        <h3 class="action-title">Sistema</h3>
                        
                        <div class="action-item" id="btnHelp">
                            <div class="action-icon">‚ùì</div>
                            <div class="action-content">
                                <div class="action-text">Ajuda & Suporte</div>
                                <div class="action-subtext">Tire suas d√∫vidas</div>
                            </div>
                            <div class="action-arrow">‚Ä∫</div>
                        </div>
                        
                        <div class="action-item" id="btnAbout">
                            <div class="action-icon">‚ÑπÔ∏è</div>
                            <div class="action-content">
                                <div class="action-text">Sobre o App</div>
                                <div class="action-subtext">Vers√£o 1.0.0</div>
                            </div>
                            <div class="action-arrow">‚Ä∫</div>
                        </div>
                    </div>
                </div>
                
                <div class="logout-section">
                    <button class="logout-btn" id="btnLogout">
                        <span>Sair da Conta</span>
                    </button>
                </div>
            </div>
            
            <div class="notification" id="notification"></div>
        </div>
    </div>

    <script>
        // Elementos
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const userEmail = document.getElementById('userEmail');
        const userBadge = document.getElementById('userBadge');
        const userType = document.getElementById('userType');
        const statMaps = document.getElementById('statMaps');
        const statFindings = document.getElementById('statFindings');
        const statPoints = document.getElementById('statPoints');
        const perfilStats = document.getElementById('perfilStats'); // NOVO ELEMENTO
        const btnLogout = document.getElementById('btnLogout');
        const btnBack = document.getElementById('btnBack');
        const btnEditAvatar = document.getElementById('btnEditAvatar');
        const notification = document.getElementById('notification');

        // Fun√ß√£o para mostrar notifica√ß√£o
        function showNotification(message, type = 'success') {
            notification.textContent = message;
            notification.style.display = 'block';
            notification.style.background = type === 'success' ? 'var(--primary-color)' : 'var(--error-color)';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // Carregar dados do usu√°rio
        function loadUserData() {
            const user = localStorage.getItem('user');
            if (!user) {
                window.location.href = '../Login/LoginScreen.html';
                return;
            }
            
            const userData = JSON.parse(user);
            
            // Atualizar informa√ß√µes do usu√°rio
            userName.textContent = userData.name || 'Usu√°rio';
            userEmail.textContent = userData.email;
            userType.textContent = userData.type === 'arqueologo' ? 'Arque√≥logo' : 'P√∫blico';
            
            // Configurar avatar
            const avatarColor = userData.type === 'arqueologo' ? '#7D1B1C' : '#2d3748';
            const avatarText = userData.name ? userData.name.charAt(0).toUpperCase() : 'U';
            userAvatar.innerHTML = `<span style="color: white;">${avatarText}</span>`;
            userAvatar.style.background = avatarColor;
            
            // Configurar badge
            userBadge.style.background = userData.type === 'arqueologo' ? 'var(--primary-color)' : 'var(--secondary-color)';
            
            // ** L√ìGICA DE OCULTA√á√ÉO DE ESTAT√çSTICAS **
            if (userData.type === 'arqueologo') {
                 // Se for arque√≥logo, carrega as estat√≠sticas
                loadUserStats();
                perfilStats.style.display = 'grid'; // Garante que esteja vis√≠vel para arque√≥logos
            } else {
                 // Se for p√∫blico, oculta a se√ß√£o de estat√≠sticas
                perfilStats.style.display = 'none';
            }
        }

        // Carregar estat√≠sticas do usu√°rio (s√≥ √© chamada se for arque√≥logo)
        function loadUserStats() {
            const savedMaps = localStorage.getItem('userMaps');
            const maps = savedMaps ? JSON.parse(savedMaps) : [];
            
            let totalFindings = 0;
            let totalPoints = 0;
            
            // Calcular totais (simula√ß√£o)
            maps.forEach(map => {
                totalFindings += map.points || 0;
                totalPoints += (map.points || 0) * 10; // 10 pontos por achado
            });
            
            statMaps.textContent = maps.length;
            statFindings.textContent = totalFindings;
            statPoints.textContent = totalPoints;
        }

        // Realizar logout
        function handleLogout() {
            if (confirm('Tem certeza que deseja sair da sua conta?')) {
                localStorage.removeItem('user');
                showNotification('Logout realizado com sucesso!');
                
                setTimeout(() => {
                    window.location.href = '../Login/LoginScreen.html';
                }, 1000);
            }
        }

        // Editar avatar (simula√ß√£o)
        function handleEditAvatar() {
            showNotification('Funcionalidade em desenvolvimento');
        }

        // Voltar para a tela anterior
        function handleBack() {
            const user = localStorage.getItem('user');
            if (user) {
                const userData = JSON.parse(user);
                if (userData.type === 'arqueologo') {
                    window.location.href = '../GaleriaArqueologos/GaleriaArqueologosScreen.html';
                } else {
                    window.location.href = '../GaleriaPublico/GaleriaPublicoScreen.html';
                }
            }
        }

        // Event Listeners
        btnLogout.addEventListener('click', handleLogout);
        btnBack.addEventListener('click', handleBack);
        btnEditAvatar.addEventListener('click', handleEditAvatar);

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            loadUserData();
        });
    </script>

    <style>
        .perfil-container {
            padding: 0 16px 80px 16px;
        }

        .perfil-header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 24px;
        }

        .avatar-container {
            position: relative;
            display: inline-block;
            margin-bottom: 16px;
        }

        .avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 600;
            color: white;
            margin: 0 auto;
        }

        .avatar-edit {
            position: absolute;
            bottom: 0;
            right: 0;
            background: var(--secondary-color);
            color: var(--primary-color);
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            cursor: pointer;
            border: 2px solid var(--surface-color);
        }

        .perfil-info {
            text-align: center;
        }

        .user-name {
            color: var(--primary-color);
            font-size: 20px;
            font-weight: 600;
            margin: 0 0 4px 0;
        }

        .user-email {
            color: var(--text-secondary);
            font-size: 14px;
            margin: 0 0 12px 0;
        }

        .user-badge {
            display: inline-block;
            background: var(--primary-color);
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
        }

        .perfil-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px 12px;
            text-align: center;
            transition: all 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .stat-number {
            color: var(--primary-color);
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 500;
        }

        .perfil-actions {
            margin-bottom: 32px;
        }

        .action-group {
            margin-bottom: 24px;
        }

        .action-title {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 600;
            margin: 0 0 12px 0;
            padding: 0 12px;
        }

        .action-item {
            display: flex;
            align-items: center;
            padding: 16px 12px;
            background: var(--surface-color);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .action-item:hover {
            background: var(--accent-color);
            transform: translateX(4px);
        }

        .action-icon {
            font-size: 20px;
            margin-right: 12px;
            width: 24px;
            text-align: center;
        }

        .action-content {
            flex: 1;
        }

        .action-text {
            color: var(--text-primary);
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .action-subtext {
            color: var(--text-muted);
            font-size: 13px;
        }

        .action-arrow {
            color: var(--text-muted);
            font-size: 18px;
            font-weight: bold;
        }

        .logout-section {
            padding: 0 12px;
        }

        .logout-btn {
            width: 100%;
            background: transparent;
            border: 2px solid var(--error-color);
            border-radius: 8px;
            padding: 14px;
            color: var(--error-color);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: var(--error-color);
            color: white;
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .perfil-container {
                padding: 0 12px 70px 12px;
            }

            .perfil-header {
                padding: 20px 0;
            }

            .avatar {
                width: 70px;
                height: 70px;
                font-size: 28px;
            }

            .user-name {
                font-size: 18px;
            }

            .stat-card {
                padding: 16px 8px;
            }

            .stat-number {
                font-size: 20px;
            }
        }
    </style>
</body>
</html>